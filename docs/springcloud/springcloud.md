

# 什么是微服务

**微服务架构是一种架构概念**，指将一个大型应用程序拆分成多个小型服务，并通过互联网协议进行通信。每个服务都独立部署、运行、迭代，由一个小团队负责开发维护，可以独立扩展和升级，从而实现更高效、更灵活的开发和部署。微服务架构可以使得应用系统更具弹性，更容易适应不同的需求变化和规模变化。



微服务架构优点：

1. 高可靠性：微服务架构可以将应用拆分成多个小的模块，这样当某个模块发生故障时不会影响整个应用的正常运行。

2. 独立性：每个微服务都是独立的，可以单独进行开发、测试、部署和扩展，提高开发团队的灵活性。

3. 易于维护和升级：微服务架构使得应用的组件化部署和更新变得非常容易，不需要对整个应用进行重大改动。

4. 高扩展性：微服务架构能够根据业务需求灵活扩展，增加或减少服务组件。

5. 技术异构性：微服务架构允许不同的服务使用不同的语言、框架和技术栈进行开发，能够充分利用各种技术的优势，提高开发效率和质量。

微服务架构缺点：

1. 增加系统复杂度：微服务架构涉及到多个服务的协作，可能导致系统的复杂度增加，需要增加管理和监控的工作量。

2. 服务间通信：微服务架构中的服务需要通过网络进行通信，这可能导致性能瓶颈和网络延迟问题。

3. 分布式事务：由于微服务架构的服务是独立的，需要处理分布式事务问题，这增加了开发和维护的难度。

4. 测试难度：由于微服务架构涉及多个服务的协作，测试成为了一个更加困难的问题。

5. 运维工作量：微服务架构中的复杂性需要更多的人力资源来进行运维和监控，这增加了运维的工作量。



# CAP理论

**CAP 理论**

> 一个分布式系统最多只能同时满足一致性,可用性和分区容错性这三项中的两项。
>
> 备注：一致性(Consistency),可用性(Availability)和分区容错性(Partition tolerance)

- 一致性：所有节点在同一时间的数据完全一致。

- 可用性：服务一直可用，而且是正常响应时间

- 分区容错性：即分布式系统在遇到某节点或网络分区故障的时候，仍然能够对外提供满足一致性和可用性的服务

**CAP 权衡**

> 通过 CAP 理论，我们知道无法同时满足一致性、可用性和分区容错性这三个特性，那要舍弃哪个呢？

- 对于多数大型互联网应用的场景，主机众多、部署分散，而且现在的集群规模越来越大，所以节点故障、网络故障是常态， 而且要保证服务可用性达到 N 个 9，即保证 P 和 A，舍弃C（退而求其次保证最终一致性）。 虽然某些地方会影响客户体验，但没达到造成用户流程的严重程度。
- 对于涉及到钱财这样不能有一丝让步的场景，C 必须保证。网络发生故障宁可停止服务，这是保证 CA，舍弃 P。 貌似这几年国内银行业发生了不下 10 起事故，但影响面不大，报到也不多，广大群众知道的少。
- 还有一种是保证 CP，舍弃 A。例如网络故障是只读不写。 孰优孰略，没有定论，只能根据场景定夺，适合的才是最好的。



# BASE理论

> eBay 的架构师 Dan Pritchett 源于对大规模分布式系统的实践总结，在 ACM 上发表文章提出 BASE 理论，BASE 理论是对 CAP 理论的延伸，核心思想是即使无法做到强一致性（Strong Consistency，CAP 的一致性就是强一致性），但应用可以采用适合的方式达到最终一致性（Eventual Consitency）。

**基本可用（Basically Available）**

基本可用是指分布式系统在出现故障的时候，允许损失部分可用性，即保证核心可用。

电商大促时，为了应对访问量激增，部分用户可能会被引导到降级页面，服务层也可能只提供降级服务。这就是损失部分可用性的体现。

**软状态（Soft State）**

软状态是指允许系统存在中间状态，而该中间状态不会影响系统整体可用性。分布式存储中一般一份数据至少会有三个副本，允许不同节点间副本同步的延时就是软状态的体现。mysql replication 的异步复制也是一种体现。

**最终一致性（Eventual Consistency）**

最终一致性是指系统中的所有数据副本经过一定时间后，最终能够达到一致的状态。弱一致性和强一致性相反，最终一致性是弱一致性的一种特殊情况。

**ACID 和 BASE 的区别与联系**

1. ACID 是传统数据库常用的设计理念，追求强一致性模型。
2. BASE 支持的是大型分布式系统，提出通过牺牲强一致性获得高可用性。
3. ACID 和 BASE 代表了两种截然相反的设计哲学，在分布式系统设计的场景中，系统组件对一致性要求是不同的，因此 ACID 和 BASE 又会结合使用。



# 微服务带来的挑战

> 一项技术的出现必定伴随着一定的问题。微服务也不例外。虽然说解决了耦合性，提高了独立性，高可用性，高扩展性，但是也带来了分布式治理，分布式通讯，分布式事务，分布式缓存等等一系列问题。

最常见的几大类问题：

- 服务这么多如何治理
- 服务之间如何通讯
- 服务挂了怎么办
- 服务之间事务如何解决（分布式事务）

**Spring Cloud Netflix**提供了一套微服务的解决方案，但是随着其进入维护阶段，**Spring Cloud Alibaba**接着提供了一套解决方案。

常见的鹅厂也推出了自己的解决方案 Spring Cloud Tencent。归根结底还是为了解决上述几大类问题。

# Spring Cloud

提起微服务，不得不提 Spring Cloud 全家桶系列，SpringCloud 是若干个框架的集合，包括 spring-cloud-config、spring-cloud-bus 等近 20 个子项目，提供了服务治理、服务网关、智能路由、负载均衡、断路器、监控跟踪、分布式消息队列、配置管理等领域的解决方案。

Spring Cloud 通过 Spring Boot 风格的封装，屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、容易部署的分布式系统开发工具包。

一般来说，Spring Cloud 包含以下组件，主要以 Netflix 开源为主：

![img](https://pic4.zhimg.com/v2-2d78afcc4e7019b9788478345059a9a3_r.jpg)





# Spring Cloud Alibaba

> 官方地址：https://spring.io/projects/spring-cloud-alibaba
>
> Spring Cloud Alibaba 是一套微服务解决方案，包含开发分布式应用微服务的必需组件，方便开发者通过 Spring Cloud 编程模型轻松使用这些组件来开发分布式应用服务。
>
> 依托 Spring Cloud Alibaba，您只需要添加一些注解和少量配置，就可以将 Spring Cloud 应用接入阿里微服务解决方案，通过阿里中间件来迅速搭建分布式应用系统。

核心功能：

- 服务治理
- 服务限流降级
- 服务消息驱动
- 分布式事务
- 阿里云对象存储
- 等等




